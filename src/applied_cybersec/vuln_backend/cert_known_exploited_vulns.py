import requests
import json
import datetime

# Retrieve known exploited vulnerabilities from cisa.gov

response = requests.get("https://www.cisa.gov/sites/default/files/feeds/known_exploited_vulnerabilities.json")
json_response = response.json()

vulns = json_response.get('vulnerabilities')

vuln_dict = {}
vuln_list = []

two_weeks = datetime.timedelta(weeks=2)
now = datetime.datetime.now()

for vuln in vulns:

    date_time_obj = datetime.datetime.strptime(vuln.get('dateAdded'), '%Y-%m-%d')
    dueDate = datetime.datetime.strptime(vuln.get('dateAdded'), '%Y-%m-%d')

    # only write out vulnerabilities that are within the given range - should be discussed with team!
    if (now - two_weeks) <= dueDate + two_weeks:
        # list of dictionaries containing all vulns
        vuln_dict["cveID"] = vuln.get('cveID')
        vuln_dict["dateAdded"] = vuln.get('dateAdded')
        vuln_dict["dueDate"] = vuln.get('dueDate')
        vuln_list.append(vuln_dict)

print(vuln_list)
